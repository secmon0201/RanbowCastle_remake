# ⚔️ Sec_AutoBattleAI 智能战斗 AI (v19.0 续航大师版) 使用手册

## 1. 插件简介
**Sec_AutoBattleAI** 是专为 `Sec_BattleSystemInstance.js` 战斗体系打造的顶级战术 AI。
v19.0 版本引入了 **“性价比计算” (Cost-Effectiveness)** 和 **“真实治疗模拟”**。AI 不仅能看懂复杂的技能机制，还能精打细算，在保证生存的前提下选择最省蓝、收益最高的战术（例如利用普攻触发连招回血）。

---

## 2. 核心战术逻辑 (v19.0)

### 2.1 资源性价比 (Cost Awareness)
AI 会计算技能的 **净收益**。
> **净评分 = (预期总伤害/治疗收益) - (MP/TP 消耗惩罚)**

* **省蓝逻辑**：在收益相近的情况下，AI 会绝对优先选择 **0消耗** 的技能（如普攻触发连招）。
* **救命逻辑**：当队友濒死时，治疗收益极高，此时 AI 会忽略蓝耗惩罚，全力救人。

### 2.2 真实治疗模拟 (True Heal Simulation)
AI 不再通过死板的权重来判断治疗，而是模拟计算 **“这口奶下去实际能回多少血”**。
* **濒死 (HP < 40%)**：每回 1 点血，计 **20 分**。
* **受伤 (HP < 80%)**：每回 1 点血，计 **1.5 分**。
* **满血/溢出**：计 **0 分** 或负分。
* **结果**：如果普攻触发的群奶总量 > 单体大加血，且更省蓝，AI 会果断选择普攻。

### 2.3 连招铺垫 (Combo Setup)
AI 懂得 **“种地”与“收菜”** 的循环：
* **种地阶段**：当队友身上没有关键 Buff 时，AI 识别出上 Buff 是为了后续连招，给予高额“铺垫分”，优先释放。
* **收割阶段**：当队友已有 Buff 时，AI 识别出普攻能触发 Buff 回血/伤害，给予高额“连招分”，优先普攻。

### 2.4 蓄力闭环 (Charge Loop)
* **防内鬼**：若自身已有 `<受击蓄力>` 状态，AI **严禁** 使用任何可能刷新该状态的技能，防止清空蓄力池。
* **智能释放**：只有当蓄力池有伤害 (`_secStoredDmg > 0`) 且释放收益高时，才使用释放技能。

---

## 3. 标签配置指南 (Note Tags)

请将以下标签填入 **技能 (Skill)**、**角色 (Actor)** 或 **状态 (State)** 的备注栏中。

### A. 技能标签 (Skill Note)

#### ⚔️ 输出与机制类
| 标签格式 | 作用说明 | AI 行为逻辑 |
| :--- | :--- | :--- |
| `<斩杀追击: 30, Formula>` | 敌人HP<30%触发额外伤 | **斩杀逻辑**：若计算出总伤 ≥ 敌人当前HP，**绝对优先**使用。 |
| `<蓄力释放: StateID, Formula>` | 释放蓄力池造成伤害 | **释放逻辑**：仅在有蓄力伤害时使用。代入蓄力值计算收益。 |
| `<受击蓄力: StateID>` | 获得蓄力状态 | **保护逻辑**：若自身已有该 StateID，本技能权重 **-999999** (熔断禁用)。 |
| `<状态交互: StateID, Formula, ..., Range>` | 引爆状态 | **连招逻辑**：若Range为友方且Formula<0，视为**高效治疗**手段。 |
| `<力场共鸣: StateID, Mode, Formula...>` | Spread(扩散)/Gather(聚焦) | **全场扫描**：同时计算对敌伤害和对友回血的总收益。 |
| `<状态循环: ID1, ID2, ID3>` | 状态升级/循环 | **运营逻辑**：未满层优先叠层；满层后转为寻找引爆技能。 |
| `<溅射伤害: Rate, Range>` | 对周围造成溅射 | **AOE逻辑**：模拟溅射总伤，选择最佳中心目标。 |
| `<技能吸血: Rate>` | 造成伤害并回血 | **救命逻辑**：自身 HP < 50% 时，权重提升。 |
| `<推条: Val>` / `<拉条: Val>` | 改变行动条 | **控制逻辑**：视为战术控制技能，常驻高权重。 |

#### 🤖 AI 干预类 (手动控制)
| 标签格式 | 说明 |
| :--- | :--- |
| `<AI_Priority: 数值>` | 直接增加该技能的基础评分。 |
| `<AI_Type: Heal>` | 强制视为治疗技能。 |
| `<AI_Type: Support>` | 强制视为辅助技能。 |

### B. 角色/装备标签 (Actor/Equip Note)
| 标签格式 | 说明 |
| :--- | :--- |
| `<守护光环: StateID>` | 声明该角色依赖此状态。**未开必开，已开不重复**。 |
| `<队友协战: Type, Chance, SkillID>` | 声明该角色会协战。AI 决策时会计算队友的协战伤害。 |

---

## 4. 插件参数详解

### ⚖️ 数值平衡 (Balance Settings)
* **WeightDamage**: 伤害评分倍率 (默认 1.0)。
* **HealNormMult**: 普通回血评分倍率 (默认 1.5)。*调高此值让奶妈更爱补血。*
* **HealCritMult**: 濒死回血评分倍率 (默认 20.0)。*确保 AI 绝不见死不救。*

### 🔋 资源性价比 (Cost Settings)
* **WeightMP**: MP 消耗惩罚 (默认 20)。*每耗 1 点蓝扣 20 分。*
* **WeightTP**: TP 消耗惩罚 (默认 10)。

### 🛡️ 战术权重 (Tactical Weights)
* **WeightHealCrisis**: 救命优先权 (15000)。*高于确杀权重。*
* **WeightLethal**: 确杀优先权 (10000)。
* **WeightCycle**: 叠层运营权重 (3500)。
* **WeightSetup**: 铺垫(种地)权重 (2000)。
* **WeightComboSpecial**: 普攻群奶特权分 (1000)。*鼓励使用能触发连招的普攻。*

---

## 5. 常见问题 (FAQ)

**Q: 为什么奶妈明明有蓝，却一直用普攻回血？**
A: 因为 v19.0 计算了性价比。如果普攻触发的连招回血量够用（能把血线拉回安全区），且不耗蓝，AI 就会认为普攻比耗蓝的技能**更赚**。这是“续航大师”的体现。

**Q: 为什么 AI 甚至不放斩杀技能？**
A: 可能是该技能蓝耗太高，或者计算出的溢出伤害收益不如保留蓝量（虽然斩杀权重很高，但如果此时全队濒死，AI 仍会优先救人）。

**Q: 如何让 AI 更激进一点？**
A: 调高 `WeightDamage` (伤害倍率)，或者调低 `WeightMP` (蓝耗惩罚)。